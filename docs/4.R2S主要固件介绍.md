### 原生 OpenWrt 固件

#### 1. OpenWrt 官方主线支持 R2S

* 2020 年 7 月 28 日，OpenWrt 官方主线加入了对 NanoPi R2S 的正式支持，使用 Longterm Kernel 5.4 内核。感谢为此付出努力的一众网友，感谢 [OpenWrt](https://openwrt.org/) 官方、[Project OpenWrt](https://github.com/project-openwrt) 项目组 和 [Quintus Chu](https://t.me/quintuschu) 大佬，感谢世界各地为开源社区努力贡献的朋友们。  

  源码地址：[openwrt/openwrt](https://github.com/openwrt/openwrt)  

#### 2. R2S Club 群友基于原生 OpenWrt 源码提供的预编译固件

  源于开源社区的努力，使用 OpenWrt 官方源码，各路大佬按自身所需定制编译。 __有特殊需求者请自行编译，不提供任何免费技术支持__ ，现成固件请自行甄选使用。OpenWrt 固件分为 EXT4 格式版本及 SquashFS 格式版本，若使用 TLC 类型 TF 卡写入 SquashFS 格式的固件启动失败，才建议换用 EXT4 格式固件。SquashFS 格式固件可在误配置等情况下使用恢复固件初始设置重置系统（使用 LuCI 管理页面相关菜单或使用 `firstboot` 等命令），EXT4 格式则不具备此功能。下列基于原生 OpenWrt 源码编译固件均提供 SquashFS 格式，部分提供 EXT4 格式。  

  __固件介绍详见各固件仓库主页的 README 和 Releases。__ 部分超频固件保持 1.45V 电压超频至 1608 MHz，发热不变，更高性能。部分固件自带 Soc 调频，不懂不要动。电压表 1 GHz 下都相同，不建议频率低于 800 MHz，一切问题后果自负。若出现反复重启不能稳定，说明 Soc 体质偏差，建议放弃超频。  

  设置错误或误操作后，SquashFS 可执行重置，部分固件带了 `fuck` 组件清除残留设置，使用更佳。强烈建议在刷写 SquashFS 固件后执行 `fuck` 或者 `firstboot -y && reboot now` ，使用备份和升级保留备份前请务必确保清楚了解所做的操作。  

* QiuSimons（404 大佬）  
  地址：[project-openwrt/R2S-OpenWrt](https://github.com/project-openwrt/R2S-OpenWrt)  

* Quintus Chu（502 大佬）  
  地址：[quintus-lab/Openwrt-R2S](https://github.com/quintus-lab/Openwrt-R2S)  

* CN_SZTL（高大全版）  
  地址：[Telegram @nanopi\_r2s](https://t.me/nanopi\_r2s)  
  *<包含 18.06 版本>*  

* Kane Green  
  地址：[KaneGreen/R2S-OpenWrt](https://github.com/KaneGreen/R2S-OpenWrt)  

* Nick Bot  
  地址：[nicksun98/R2S-OpenWrt](https://github.com/nicksun98/R2S-OpenWrt)  

* 墨子冥  
  地址：[msylgj/R2S-OpenWrt](https://github.com/msylgj/R2S-OpenWrt)  

* Chuck  
  地址：[fanck0605/openwrt-nanopi-r2s](https://github.com/fanck0605/openwrt-nanopi-r2s)  
  
  *<注意 Branch>*  
  
**欢迎补充，欢迎您为开源社区作出贡献。如果您在 Telegram [NanoPi R2S Club](https://t.me/joinchat/JcBRDFWlAEMysWbVdPsxFw) 群内询问哪个固件最好用/最稳定等愚蠢问题，您将被移出群聊，因为您没有阅读 Wiki，以及您并没有看到这行文字**  
  
#### 3. 基于 Jayanta525 源码的类原生固件

  使用 [Jayanta525/openwrt-nanopi-r2s](https://github.com/jayanta525/openwrt-nanopi-r2s) 的源码，是原生支持前的重要阶段。但是有未改好 IRQ 等等问题，使用舒适度和性能完整度较落后于 OpenWrt 官方以及群友发布的版本。  

  “这个家伙很懒，什么都没有留下。”  

---

### FriendlyWrt 固件

  已不推荐使用，内容已转移，[点击查看](other/friendlywrt.md)  

---

### Armbian 固件

* 地址：[Armbian/nanopi-r2s](https://www.armbian.com/nanopi-r2s/)  

* 教程来自 [NanoPi R2S Club](https://t.me/joinchat/JcBRDFWlAEMysWbVdPsxFw) 群主 Darya 的博客：  

  > 地址: [e.g.daryasyr.com](https://e.g.daryasyr.com)  

---

### 其它Linux 发行版固件

* 等待 [NanoPi R2S Club](https://t.me/joinchat/JcBRDFWlAEMysWbVdPsxFw) 群主 Darya 补充，敬请期待！  

---

### NanoPi R2S 在线升级 / 降级 / 更改固件  

#### 1. 使用 LuCI 网页管理界面的"备份/升级"功能更新固件

  LuCI 管理页面，进入"系统-备份/升级"，选择刷写新的固件，上传要刷写的固件应是 .img.gz 或 .img 格式。  

  请自行核对 MD5 值和 SHA256 值确保文件一致性，选择"刷写固件"，R2S 会更新系统并且会自行重启。  

  *<注意！如果是使用 SquashFS 格式的固件，由于 TLC 类型 TF 卡的擦写缺陷，即使选择“不保存配置“仍然会保存配置(使用 EXT4 格式固件，或使用 MLC TF 卡及 TF 卡转 emmc 的除外)>*  
 
  如果是使用普通市售 TLC 类型 TF 卡，建议升级完成重启后，使用SSH进一步清除旧配置：  

  ```shell  
  firstboot -y && reboot now
  ```

  *<注意！ TLC 类型 TF 卡，无论是使用读卡器写卡刷入固件还是在线更新固件，当使用 SquashFS 格式固件时，如出现不能正常启动、或旧配置文件没能清理导致无法正常运作。请反复尝试或写入其它大文件或换用 EXT4 格式固件消除擦写缺陷>*  

#### 2. 命令行下更新固件  

  前提：

> 1. 熟悉简单 SSH 命令行操作  
>
> 2. 通过 scp、sftp 或“文件传输”（部分固件有编译此应用，管理页面“系统 - 文件传输”）等方式，把 .img 或 .img.gz 格式固件上传至 R2S ，例如放在 /tmp 目录下。  

  直接使用 dd 命令把固件 img 全新写入TF卡更新系统，"/dev/mmcblk0" 是 R2S 的 TF 卡设备位置，将 <openwrt.img.gz> 替换成实际文件名（不包括 <> 括号）。  

  ```shell  
  dd if=/tmp/<openwrt.img> of=/dev/mmcblk0 conv=fsync
  reboot
  ```  

  使用内置的 sysupgrade 命令：  

  ```shell  
  sysupgrade -v /tmp/<openwrt.img.gz>
  reboot
  ```  

  等待重启后，重连 SSH，输入：  

  ```shell  
  firstboot -y && reboot now
  ```
  
##### 从FriendlyWrt 升级到 OpenWrt

  建议使用 dd 命令进行写盘  

  ```shell  
  dd if=/tmp/upload/<openwrt.img> of=/dev/mmcblk0 conv=fsync
  reboot
  ```
  
---

### 常见问题

* Q: 开机后网口灯亮，分配不到 IP / 分配到 169.254.x.x ？  
  A: 确认您刷的固件插入正确的网口，如正确，手动分配子网内 IP，若可以进入后台，恢复到出厂设置（执行重置），进行干净部署。若未解决，进行换网口操作。  

* Q: 固件开启 BBR 加速了吗？  
  A: 原生固件默认打开 BBR 加速，部分固件编译带有 Turbo ACC 工具可检查，在“网络 - Turbo ACC 加速”。5.4 内核的 BBR 已修复万兆掉速问题。  

* Q: Flow 加速 / 软件流量分载 / Shortcut-FE 加速要开吗？  
  A: Flow Offloading / Shortcut-FE 等建议带宽超过 500 Mbps 的用户打开。请勿同时开启，切换使用时建议重启以避免不必要的问题。 两者性能基本一致。 

* Q: HWNAT / 硬件流量分载要开吗？  
  A: OpenWrt 的硬件流量分载仅支持 MTK76xx，即使勾选也没有任何意义。  

* Q: DNS 加速要开吗？  
  A: 如你的网络可以正常解析 DNS，非必要情况下无需开启；此项功能可能会与 AdGuardHome、SmartDNS 等发生冲突，请注意。  

* Q: FullCone NAT 哪里开？可以开吗？  
  A: 在 “网络 - 防火墙 - FullCone” 打开，建议打开。部份固件安装有 Turbo ACC 应用，可打开检查。某些主题可能存在显示项兼容性问题，可在防火墙的 WAN 口设置里打开。  

* Q: 类原生固件可以使用 sysupgrade 吗？  
  A: 可以上传 img.gz 文件在线升级，不建议保留配置。RootFS 相同的固件，使用 TLC 类型 TF 卡，可能存在选择“不保存配置”升级也是保存配置，参考 [TF卡 其他常见问题](/2.R2S所需配件?id=_3-其他常见问题) 条目。  

* Q: 建议使用备份吗？  
  A: 如果你长期使用某一个人的版本，且未有重大更新，建议保留配置直接升级。跨版本升级请尽量干净部署。  

* Q: 为什么更改不了 LAN IP / 管理地址？  
  A: 这是 OpenWrt 19.07 带来的新 Feature，用于误操作失效后自动回滚。可点击保存并应用旁边向下的箭头，选择“强制应用”，或参考 [SSH 操作](/5.OpenWrt使用基本介绍?id=ssh-操作) 条目。  

  其他问题请先学会善用 [搜索引擎](https://www.google.com/)，尝试自行解决，对于无法自行解决的问题欢迎阅读 [提问的艺术](https://github.com/betaseeker/How-To-Ask-Questions) 后在 Telegram 群 [NanoPi R2S Club](https://t.me/joinchat/JcBRDFWlAEMysWbVdPsxFw) 中提出、讨论。  
